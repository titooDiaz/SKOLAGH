<!DOCTYPE html>
<head>
    <title>Mirar materia</title>
</head>

{% extends 'base.html' %}

{% load static %}

{% block content %}
{% load humanize %}

<div class="my-6">
    <h5 class="text-5xl text-center font-bold text-black zoom-4 mb-8">Hola {{request.user.first_name}}!</h5>
</div>

<!-- Información de la Materia -->
<div class="mb-8">
    <div class="flex flex-col items-center bg-white border border-gray-200 rounded-lg shadow md:flex-row md:max-w-4xl hover:bg-gray-100 mx-auto">
        <img class="object-cover w-full rounded-t-lg h-96 md:h-auto md:w-48 md:rounded-none md:rounded-s-lg p-4" src="{{subject.photo.url}}" alt="">
        <div class="flex flex-col justify-between p-4 leading-normal w-full">
            <h5 class="mb-2 text-2xl font-bold tracking-tight text-gray-900">{{subject.name_1}}</h5>
            <p class="mb-3 font-normal text-gray-700">{{subject.description_1}}</p>
            <div class="flex gap-4 text-sm text-gray-600">
                <span><i class="fa-solid fa-user mr-1"></i>{{subject.teacher_1}}</span>
                <span><i class="fa-solid fa-calendar mr-1"></i>Corte:{{current_court.court_number}} ({{current_court.start_date|date:"d M Y"}} - {{current_court.end_date|date:"d M Y"}})</span>
                <span><i class="fa-solid fa-clock mr-1"></i>Intensidad horaria de - horas semalanes</span>
            </div>
        </div>
    </div>
</div>

<!-- Título Special para actividades -->
{% include "ui/titles/special.html" with title="Actividades por Cortes" description="Gestiona tus actividades calificables y recursos de clase" %}

<!-- Navegación de Cortes -->
<div class="mb-6">
    <div class="flex justify-center">
        <div class="flex space-x-2 bg-white p-2 rounded-lg shadow-sm">
            {% for corte in courts %}
                <button onclick="showCorte({{ forloop.counter }})"
                        id="btn-corte-{{ forloop.counter }}"
                        class="corte-btn px-4 py-2 rounded-md font-medium transition-all duration-200 {% if forloop.first %}bg-orange-500 text-white{% else %}bg-gray-200 text-gray-700 hover:bg-orange-200{% endif %}">
                    Corte {{ forloop.counter }}
                </button>
            {% endfor %}
        </div>
    </div>
</div>

<!-- Contenido de cada Corte -->
{% for corte in courts %}
<div id="corte-{{ forloop.counter }}" class="corte-content {% if not forloop.first %}hidden{% endif %}">
    <div class="bg-white rounded-lg shadow-lg p-6 mb-6">

        <!-- Header del Corte -->
        <div class="flex justify-between items-center mb-6">

            {% include "ui/titles/subtitle.html" with subtitle=corte.court_number title=forloop.counter description=corte.description %}
            
            <div class="bg-orange-100 px-4 py-2 rounded-lg">
                {% if corte.promedio %}
                    <span class="text-orange-700 font-bold">Promedio: {{ corte.promedio }}/5.0</span>
                {% else %}
                    <span class="text-gray-600 font-bold">Sin calificaciones</span>
                {% endif %}
            </div>
        </div>

        <!-- Actividades -->
        {% if corte.activities %}
        <div class="mb-6">
            <div class="flex items-center justify-between mb-4 cursor-pointer" data-collapse-target="collapse-actividades-{{ forloop.counter }}">
                <h4 class="text-xl font-semibold text-gray-700 flex items-center">
                    <i class="fa-solid fa-clipboard-check text-orange-500 mr-2"></i>
                    Actividades Calificables
                </h4>
                <i class="fa-solid fa-chevron-down transform transition-transform duration-200"></i>
            </div>

            <div data-collapse="collapse-actividades-{{ forloop.counter }}" class="h-auto overflow-hidden transition-all duration-300 ease-in-out space-y-4">
                {% for actividad in corte.activities %}
                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                        <div class="flex justify-between items-start mb-2">
                            <h5 class="font-bold text-lg text-gray-800">{{ actividad.title }}</h5>
                            <div class="flex gap-2">
                                <span class="bg-orange-500 text-white px-2 py-1 rounded text-sm font-medium">{{ actividad.weight }}%</span>
                                {% if actividad.grade %}
                                    <span class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm font-medium">{{ actividad.grade }}/5.0</span>
                                {% else %}
                                    <span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-sm font-medium">Pendiente</span>
                                {% endif %}
                            </div>
                        </div>
                        <p class="text-gray-600 mb-2">{{ actividad.description }}</p>
                        <div class="flex justify-between text-sm text-gray-500">
                            <span><i class="fa-solid fa-calendar mr-1"></i>Fecha límite: {{ actividad.due_date|date:"d M Y - h:i A" }}</span>
                            {% if actividad.entregado %}
                                <span class="text-green-600 font-medium"><i class="fa-solid fa-check mr-1"></i>Entregado</span>
                            {% else %}
                                <span class="text-yellow-600 font-medium"><i class="fa-solid fa-clock mr-1"></i>Por entregar</span>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
        {% else %}
            <div class="text-center py-12">
                <i class="fa-solid fa-calendar-plus text-6xl text-gray-400 mb-4"></i>
                <h4 class="text-xl font-semibold text-gray-600 mb-2">Corte próximo a iniciar</h4>
                <p class="text-gray-500">Las actividades de este corte estarán disponibles pronto.</p>
            </div>
        {% endif %}

        <!-- Recursos -->
        {% if corte.resources %}
        <div class="mb-6">
            <div class="flex items-center justify-between mb-4 cursor-pointer" data-collapse-target="collapse-recursos-{{ forloop.counter }}">
                <h4 class="text-xl font-semibold text-gray-700 flex items-center">
                    <i class="fa-solid fa-book text-orange-500 mr-2"></i>
                    Recursos y Guías de Clase
                </h4>
                <i class="fa-solid fa-chevron-down transform transition-transform duration-200"></i>
            </div>
            <div data-collapse="collapse-recursos-{{ forloop.counter }}" class="h-0 overflow-hidden transition-all duration-300 ease-in-out space-y-3">
                {% for recurso in corte.resources %}
                    <div class="border border-gray-200 rounded-lg p-4 bg-blue-50">
                        <div class="flex items-center justify-between">
                            <div>
                                <h5 class="font-semibold text-gray-800">{{ recurso.title }}</h5>
                                <p class="text-gray-600 text-sm">{{ recurso.description }}</p>
                            </div>
                            <div class="flex gap-2">
                                <button class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600">
                                    <i class="fa-solid fa-download mr-1"></i>{{ recurso.action }}
                                </button>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endfor %}

<!-- JS para cambiar cortes -->
<script>
function showCorte(corteNum) {
    // Hide all cortes
    document.querySelectorAll('.corte-content').forEach(corte => corte.classList.add('hidden'));

    // Show selected corte
    document.getElementById(`corte-${corteNum}`).classList.remove('hidden');

    // Update buttons
    document.querySelectorAll('.corte-btn').forEach(btn => {
        btn.classList.remove('bg-orange-500', 'text-white');
        btn.classList.add('bg-gray-200', 'text-gray-700');
    });

    const activeBtn = document.getElementById(`btn-corte-${corteNum}`);
    activeBtn.classList.remove('bg-gray-200', 'text-gray-700');
    activeBtn.classList.add('bg-orange-500', 'text-white');
}
</script>

<!-- Import collapse.js -->
<script src="{% static 'js/windows/collapse.js' %}"></script>

{% endblock content %}